# Memory整理・最適化

## Description
04_Memoryフォルダ内の知識ノートを重複なく、綺麗に整理します。双方向リンク、タグ付け、リファクタリングを丁寧に実行します。

**重要**: 全てのファイルの中身を必ず読み込んで、内容を丁寧に分析・理解・抽象化してから整理します。

**実行原則**:
1. **必ずファイルの中身を読む** - ファイル名だけで判断しない
2. **内容を理解する** - 何について書かれているかを捉える
3. **重複を検出する** - 同じ内容や類似内容のノートを特定
4. **適切に整理する** - 統合、リファクタリング、リンク追加を実行

## 使用するツール
- `read_file`: ファイル内容を読み込む（必ず全内容を読み込む）
- `grep`: ファイル内のキーワード検索
- `codebase_search`: 関連ノートの検索
- `list_dir`: フォルダ構造の確認
- `search_replace`: ファイル内容の編集
- `run_terminal_cmd`: ファイルの移動・リネーム

## Prompt
04_Memoryフォルダ内の知識ノートを重複なく、綺麗に整理してください。

引数:
- カテゴリ（省略可）: 整理対象のカテゴリ（AI、Business、Education、Personal、Technical）
  - 省略時は全カテゴリを整理
  - 例: `/organize-memory AI` または `/organize-memory Technical`

実行内容:

### Phase 1: 現状分析（必須）

1. **フォルダ構造の確認**
   - `04_Memory/` 配下の全フォルダを確認
   - 各カテゴリのMOCファイルを確認
   - サブフォルダ構造を把握

2. **全ファイルの内容を読み込む**
   - 指定カテゴリ（または全カテゴリ）の全ファイルを読み込む
   - ファイル名だけで判断しない
   - ファイルのサイズが大きくても必ず全内容を読む

3. **重複ノートの検出**
   - 内容が同じまたは類似しているノートを特定
   - ファイル名が異なるが内容が重複しているノートを検出
   - 重複度を数値化（0-100%）
   - 重複度80%以上を「重複」として判定

4. **リンク切れの検出**
   - リンクされているが存在しないファイルを特定
   - バックリンクが0のノートを特定
   - 孤立しているノートを特定

5. **タグの分析**
   - タグが適切か確認
   - タグの一貫性を確認
   - 階層化タグの使用状況を確認

6. **ファイル名の分析**
   - 命名規則に従っているか確認
   - 日本語ファイル名か確認
   - スペースや特殊文字が含まれていないか確認

### Phase 2: 重複ノートの統合

1. **重複ノートの統合計画**
   - 重複ノートのペアを特定
   - 統合先のファイルを決定（より充実した内容のファイルをベースに）
   - 統合計画を提示

2. **統合の実行**
   - ベースファイルに不足している内容を追加
   - 統合元ファイルのリンクを統合先に更新
   - 統合元ファイルを削除（または99_Archiveに移動）
   - バックリンクを更新

3. **統合後の確認**
   - 統合が正しく完了したか確認
   - リンクが正しく更新されたか確認

### Phase 3: タグの最適化

1. **タグの標準化**
   - カテゴリに応じた適切なタグを付与
   - 階層化タグの使用を推奨
   - 例: `#ai/tools/cursor`, `#business/marketing`, `#technical/programming/nextjs`

2. **タグの一貫性確保**
   - 同じトピックには同じタグを使用
   - タグの表記ゆれを統一
   - 不要なタグを削除

3. **タグの追加**
   - 内容に基づいて適切なタグを追加
   - カテゴリタグを追加（例: `#ai`, `#business`, `#education`）
   - 関連タグを追加

### Phase 4: 双方向リンクの最適化

1. **関連ノートの検索**
   - 各ノートの内容から関連ノートを検索
   - キーワードベースで関連ノートを特定
   - セマンティック検索で関連ノートを発見

2. **リンクの追加**
   - 関連度の高いノート（80%以上）にリンクを追加
   - 前提知識となるノートにリンクを追加
   - 具体例となるノートにリンクを追加
   - MOCへのリンクを追加

3. **リンクの最適化**
   - 一般的すぎる単語へのリンクを削除
   - より具体的なノートへのリンクに変更
   - リンクの粒度を最適化（1ノートあたり5-15個程度）

4. **バックリンクの確認**
   - バックリンクが0のノートを特定
   - 適切なリンク先を提案
   - 必要に応じてリンクを追加

### Phase 5: ファイル名の統一化

1. **命名規則の確認**
   - ファイル名が日本語か確認
   - スペースが含まれていないか確認（ハイフンまたはアンダースコアを使用）
   - 特殊文字が含まれていないか確認

2. **ファイル名のリネーム**
   - 命名規則に従っていないファイルをリネーム
   - より具体的で検索しやすい名前に変更
   - 例: `memo.md` → `Cursor-キーボードショートカット.md`

3. **リネーム後のリンク更新**
   - リネームしたファイルへのリンクを更新
   - バックリンクを確認

### Phase 6: MOCの更新

1. **MOCファイルの確認**
   - 各カテゴリのMOCファイルを確認
   - `_Master-Index.md` を確認

2. **MOCの更新**
   - 新しいノートをMOCに追加
   - 統合・削除されたノートをMOCから削除
   - リンク切れを修正
   - 構造を最適化

3. **Master Indexの更新**
   - `_Master-Index.md` を更新
   - 各カテゴリのMOCへのリンクを確認

### Phase 7: フォルダ構造の最適化

1. **フォルダ構造の確認**
   - サブフォルダが適切か確認
   - 深すぎる階層（4階層以上）を検出
   - 空のフォルダを検出

2. **フォルダ構造の最適化**
   - 必要に応じてフォルダを再編成
   - 空のフォルダを削除
   - 階層を最適化（2-3階層を推奨）

## 📋 出力形式

整理完了後に以下の形式でサマリーを出力：

```markdown
## Memory整理完了

### 📊 整理サマリー

#### 重複ノート統合
- 統合したペア数: [件数]
- 統合元ファイル: [ファイル名] → [統合先ファイル名]
- 統合により削減したファイル数: [件数]

#### タグ最適化
- タグを追加したファイル数: [件数]
- タグを修正したファイル数: [件数]
- 標準化したタグ: [タグ一覧]

#### リンク最適化
- リンクを追加したファイル数: [件数]
- 追加したリンク総数: [件数]
- リンクを修正したファイル数: [件数]
- バックリンクが0だったノート: [件数] → [件数]（改善後）

#### ファイル名統一化
- リネームしたファイル数: [件数]
- リネーム例: [旧ファイル名] → [新ファイル名]

#### MOC更新
- 更新したMOC: [MOCファイル名]
- 追加したノート: [件数]
- 削除したノート: [件数]

#### フォルダ構造最適化
- 再編成したフォルダ: [フォルダ名]
- 削除した空フォルダ: [件数]

### 📈 改善統計
- 整理前のファイル数: [件数]
- 整理後のファイル数: [件数]
- 削減率: [%]
- 平均リンク数/ファイル: [数値] → [数値]（改善後）
- 平均タグ数/ファイル: [数値] → [数値]（改善後）

### ✅ 完了した作業
- [x] 重複ノートの統合
- [x] タグの最適化
- [x] 双方向リンクの追加・最適化
- [x] ファイル名の統一化
- [x] MOCの更新
- [x] フォルダ構造の最適化
```

## 📝 実行手順

1. **指定カテゴリ（または全カテゴリ）のフォルダ構造を確認**
   - `list_dir` でフォルダ構造を把握

2. **全ファイルの内容を読み込む**
   - `read_file` で全ファイルを読み込む
   - ファイル名だけで判断しない
   - ファイルが大きくても分割してでも全内容を読む

3. **重複ノートを検出**
   - 内容を比較して重複度を計算
   - 重複度80%以上を「重複」として判定

4. **重複ノートを統合**
   - より充実した内容のファイルをベースに統合
   - 統合元ファイルのリンクを更新
   - 統合元ファイルを削除またはアーカイブ

5. **タグを最適化**
   - 各ファイルのタグを確認
   - 適切なタグを追加・修正
   - タグの一貫性を確保

6. **双方向リンクを最適化**
   - 関連ノートを検索
   - リンクを追加・修正
   - バックリンクが0のノートを特定してリンクを追加

7. **ファイル名を統一化**
   - 命名規則に従っていないファイルをリネーム
   - リネーム後のリンクを更新

8. **MOCを更新**
   - 各カテゴリのMOCを更新
   - `_Master-Index.md` を更新

9. **フォルダ構造を最適化**
   - 必要に応じてフォルダを再編成
   - 空のフォルダを削除

10. **整理サマリーを出力**
    - 実行した作業のサマリーを出力
    - 改善統計を表示

## ⚠️ 注意事項

- **最重要**: ファイル名だけで判断せず、必ずファイルの中身を全て読んでから整理を判断すること
- **必須**: `read_file` toolを使ってファイルの全内容を読み込むこと
- **必須**: ファイルの内容を理解して抽象化してから整理すること
- **必須**: 重複ノートの統合は慎重に行い、内容を確認してから実行すること
- **必須**: リンクの更新は、リネームや統合の後に必ず実行すること
- **必須**: MOCの更新は、ファイルの追加・削除・移動の後に必ず実行すること
- ファイル移動時はGit履歴を保持
- サブフォルダが存在しない場合は作成
- ファイル名の日付接頭辞は保持（必要に応じて）
- 整理後、必要に応じてメタデータ（タグ・リンク）を更新
- **04_Memory** のサブフォルダ構成（AI/、Business/、Education/、Personal/、Technical/）を厳守
- 判断に迷う場合は、ユーザーに確認を求める

## 🔗 関連コマンド

- `/optimize-tag-links` - 単一ファイルのタグ・リンク最適化
- `/organize-inbox` - Inboxフォルダの整理
- `/make-memory` - InboxノートをMemory Noteに昇華
- `/find-unlinked-notes` - リンクされていないノートを検索

## 📚 参考資料

- **Brain System Rules**: [[AGENTS.md]] - システム全体のルール
- **フォルダ構成ガイド**: [[07_System/Documentation/folder-structure-guide.md]]
- **命名規則**: [[AGENTS.md#ファイル命名規則]]

